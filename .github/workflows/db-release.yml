# This workflow update the database and create a release of it everyday

name: Main Workflow
on:
  schedule:
  - cron: "*/5 * * * *" # "0 0 * * *"

jobs:
  db-release:
    name: "Database Release"
    runs-on: "ubuntu-latest"
    timeout-minutes: 30

    steps:
      - uses: actions/checkout@v2
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%d')"
      - name: Set up Python 3.7
        uses: actions/setup-python@v2
        with:
          python-version: 3.7
      - name: Install requirements
        run: |
          python -m pip install --upgrade pip
          pip install --no-deps -r requirements.txt
          pip install --no-deps .
          pip install pytest pytest-cov
      - name: "Build"
        run: |
          hashtheplanet --input ./src/tech_list.csv --output ./dist/hashtheplanet.db

      - uses: "marvinpinto/action-automatic-releases@latest"
        with:
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
          automatic_release_tag: "latest"
          prerelease: false
          title: "Database release: Latest"
          files: |
            ./dist/hashtheplanet.db
      - uses: "marvinpinto/action-automatic-releases@latest"
        with:
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
          automatic_release_tag: "${{ steps.date.outputs.date }}"
          prerelease: false
          title: "Database release: ${{ steps.date.outputs.date }}"
          files: |
            ./dist/hashtheplanet.db
